<div ng-controller="DeviceListController">
  <div class="container device-list loading center" ng-hide="devices || noresults">
    <img src="/img/loading.gif" title="Current Setting: Medium-Dark" />
    <h3>Loading...</h3>
  </div>

  <div class="container device-list loading center" ng-show="noresults">
    <img src="/img/noresults.gif" title="If the toast is without a toaster, does the toast still have meaning?" />
    <h3>No results found</h3>
  </div>

  <div class="container device-list" ng-show="devices &amp;&amp; !noresults">
    <form>
      <div class="row">
        <div class="span12">
          <div class="alert alert-success" ng-show="saved">{{ saved == true &amp;&amp; 'Saved!' || saved }}</div>

          <br />

          <!-- normal mode actions -->
          <div ng-hide="editing">
            <button class="btn btn-success" ng-click="reload()"><i class="icon-refresh icon-white"></i> Reload</button>
            <button class="btn" ng-click="edit()"><i class="icon-pencil"></i> Edit</button>
          </div>

          <!-- edit mode actions -->
          <div ng-show="editing">
            <input type="submit" class="btn btn-primary" value="Save" ng-click="save()"></input>
            <input type="submit" class="btn btn-danger" value="Cancel" ng-click="editing=false"></input>
          </div>

          <br />
        </div>
      </div>

      <div class="row">
        <div class="span12">
          <table class="table table-condensed">
            <thead>
              <tr>
                <th ng-click="sortField='id'; sortReverse=!sortReverse">ID</th>
                <th ng-click="sortField='status'; sortReverse=!sortReverse" class="center"><abbr title="Status">S</abbr></th>
                <th ng-click="sortField='properties.alert_state'; sortReverse=!sortReverse" class="center"><abbr title="Alerts"><i class="icon-warning-sign"></i></abbr></th>
                <th ng-click="sortField='name'; sortReverse=!sortReverse">Name</th>
                <th ng-click="sortField='properties.ip'; sortReverse=!sortReverse">Primary IP</th>
                <th ng-click="sortField='properties.site'; sortReverse=!sortReverse">Site</th>
                <th ng-click="sortField='properties.model'; sortReverse=!sortReverse">Model</th>
                <th ng-click="sortField='properties.rack'; sortReverse=!sortReverse">Rack</th>
                <th ng-click="sortField='properties.unit'; sortReverse=!sortReverse">Unit</th>
                <th ng-click="sortField='properties.slot'; sortReverse=!sortReverse">Slot</th>
                <th ng-click="sortField='collected_at'; sortReverse=!sortReverse">Last Seen</th>
                <th ng-click="sortField='properties.notes'; sortReverse=!sortReverse" class="center">Notes</th>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="device in devices | orderBy:sortField:sortReverse">
                <td class="id"><a tabindex="{{ devices.length + $index + 1 }}" href="#/node/{{ device.id }}">{{ device.id }}</a></td>
                <td class="status">
                  <img title="{{ (device.status || 'unknown') | titleize }}" ng-src="/img/status/{{ device.status || 'unknown' }}.png" />
                </td>
                <td class="alerts">
                  <img
                    ng-show="device.properties.alert_state"
                    title="{{ device.properties.alert_state | titleize }}"
                    ng-src="/img/alerts/{{ (device.properties.alert_state || 'unknown') }}.png"
                  />
                </td>
                <td>{{ device.name | section:'.':0:1 }}</td>
                <td>{{ device.properties.ip }}</td>
                <td>{{ device.properties.site | uppercase }}</td>
                <td>{{ device.properties.model | section:' ':-1 }}</td>
                <td>
                  <span ng-hide="editing">{{ device.properties.rack }}</span>
                  <input ng-show="editing" class="rack" type="text" ng-model="device.properties.rack">
                </td>
                <td>
                  <span ng-hide="editing">{{ device.properties.unit }}</span>
                  <input ng-show="editing" class="unit" type="text" ng-model="device.properties.unit">
                </td>
                <td>{{ device.properties.slot }}</td>
                <td>{{ device.collected_at &amp;&amp; (device.collected_at | timeAgo) || '-' }}</td>
                <td>
                  <a
                    ui-jq="popover"
                    ui-options="note_tip_options(device.properties.notes)"
                    class="note_toggle center"
                    ng-show="device.properties.notes">
                    <i class="icon icon-comment"></i>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="span12">
          <!-- edit mode actions -->
          <div ng-show="editing">
            <input type="submit" class="btn btn-primary" value="Save" ng-click="save()"></input>
            <input type="submit" class="btn btn-danger" value="Cancel" ng-click="editing=false"></input>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>