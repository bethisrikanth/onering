<h3>Default Properties</h3>

<div class="container" ng-controller="AssetDefaultsController">
  <div class="row">
    <div class="span12">
      <button class="btn" ng-click="add()"><i class="icon-plus"></i>&nbsp;Add Rule</button>
      <br />
      <br />
    </div>
  </div>

  <div class="row">
    <div class="span12">
      <table class="table table-condensed table-hover">
        <thead>
          <tr>
            <th ng-click="sortField='match'; sortReverse=!sortReverse">If the asset matches this...</th>
            <th ng-click="sortField='match'; sortReverse=!sortReverse">...then set these values on it:</th>
            <th><abbr title="Controls whether the values applied here will overwrite existing values">Overwrite?</abbr></th>
            <th> </th>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="default in defaults | orderBy:sortField:sortReverse">
            <td ng-click="edit(default)">
              <span ng-repeat="rule in default.match">
                <b>{{ rule.field }}</b> {{ rule.test || '=' }} {{ rule.value }}<br />
              </span>
            </td>
            <td ng-click="edit(default)">
              <span ng-repeat="(key,value) in default.apply">
                <b>{{ key }}</b> = {{ value }}<br />
              </span>
            </td>

            <td>
              <input type="checkbox" ng-model="default.force" ng-change="default.dirty=true"></input>
            </td>

            <td>
              <i class="icon-ok icon-white" ng-hide="default.dirty"> </i>
              <a ng-click="save(default)" ng-show="default.dirty"><i class="icon-ok"> </i></a>
              <a ng-click="remove(default)"><i class="icon-remove"> </i></a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- editor dialog -->
  <div class="modal" ng-show="current">
    <form>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Edit Asset Rule</h3>
      </div>

      <div class="modal-body">
        <fieldset>
          <legend>
            <span>Search Criteria</span>
            <a class="pull-right" ng-click="current.match.push({})"><i class="icon-plus"> </i></a>
          </legend>

          <span class="help-block">
            Only assets whose properties match these criteria will have this rule applied to them.
            <br />
            <br />
          </span>

          <table>
            <thead>
              <tr>
                <th>
                  <abbr title="Specify a specific data type to interpret values as.">Type</abbr>
                </th>
                <th>Field Name</th>
                <th> </th>
                <th>Value</th>
                <th> </th>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="match in current.match">
                <td>
                  <select ng-model="match.type" class="input-small">
                    <option value="">(auto)</option>
                    <option value="bits">bits</option>
                    <option value="bytes">bytes</option>
                    <option value="bool">boolean</option>
                    <option value="date">date</option>
                    <option value="epoch">epoch</option>
                    <option value="float">decimal</option>
                    <option value="int">integer</option>
                    <option value="str">string</option>
                  </select>
                </td>

                <td>
                  <input type="text" class="input-large" placeholder="field" ng-model="match.field">
                </td>

                <td>
                  <select ng-model="match.test" class="input-small">
                    <option value="">=</option>
                    <option value="not">&ne;</option>
                    <option value="gt">&gt;</option>
                    <option value="lt">&lt;</option>
                    <option value="gte">&ge;</option>
                    <option value="lte">&le;</option>
                    <option value="before">before</option>
                    <option value="since">since</option>
                  </select>
                </td>

                <td>
                  <input type="text" class="input-medium" placeholder="value" ng-model="match.value">
                </td>

                <td>
                  <a ng-click="current.match.splice($index,1)"><i class="icon-remove"> </i></a>
                </td>
              </tr>
            </tbody>
          </table>
        </fieldset>

        <fieldset>
          <legend>
            Apply Properties
            <a class="pull-right" ng-click="addNewProperty()"><i class="icon-plus"> </i></a>
          </legend>

          <span class="help-block">
            Represents the object that will be merged with all matching assets whenever the asset is updated.
            <br />
            <br />
          </span>

          <table>
            <tbody>
              <tr ng-repeat="(key, value) in current.apply | compact">
                <td>
                  <label class="input-medium">{{ key }}</label>
                </td>

                <td>
                  <input type="text" class="input-medium" placeholder="value" ng-model="current.apply[key]" ng-model-onblur>
                </td>

                <td>
                  <a ng-click="current.apply[key]=null"><i class="icon-remove"> </i></a>
                </td>
              </tr>

              <tr ng-show="newApplyKey">
                <td>
                  <input type="text" class="input-medium" placeholder="key.name" ng-model="newApplyKey" ng-model-onblur>
                </td>

                <td> </td>
                <td>
                  <a ng-click="newApplyKey=null"><i class="icon-remove"> </i></a>
                </td>
              </tr>
            </tbody>
          </table>
        </fieldset>
      </div>

      <div class="modal-footer">
        <input type="submit" class="btn btn-primary" data-dismiss="modal" value="Save" ng-click="save(current)">
        <a class="btn" data-dismiss="modal" ng-click="current=null">Cancel</a>
      </div>
    </form>
  </div>
</div>