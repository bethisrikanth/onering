<div class="container">
  <h1>Mesos Tasks</h1>
  <br />
  <br />

  <tabset>
    <!-- Sites -->
    <tab ng-repeat="(site, site_clusters) in clusters" heading="{{ site | uppercase }}">
      <ul class="nav nav-pills">
        <li
          ng-repeat="(site_cluster, master) in site_clusters"
          ng-click="getMesosStats(master.id)"
          ng-class="{'active': (current_cluster.cluster == site_cluster)}"
        >
          <a>{{ site_cluster }}</a>
        </li>
      </ul>

      <div ng-show="current_cluster">
        <table class="table table-condensed table-hover">
          <thead>
            <tr>
              <th>Service Name</th>
              <th>Instances</th>
              <th>CPU</th>
              <th>RAM</th>
              <th>Framework</th>
              <th>State</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <th>TOTAL</th>
              <th>{{ (current_cluster.frameworks | pluck:'tasks' | flatten).length }}</th>
              <th>{{ (current_cluster.frameworks | pluck:'tasks' | flatten) | pluck:'resources.cpus' | sum }}</th>
              <th>{{ (((current_cluster.frameworks | pluck:'tasks' | flatten) | pluck:'resources.mem' | sum) * 1024 * 1024) | autosize }}</th>
              <th></th>
              <th></th>
            </tr>

            <tr>
              <th> </th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </tbody>

          <tbody>
            <tr ng-repeat="task in (current_cluster.frameworks | pluck:'tasks' | flatten)">
              <td>{{ task.name || task.id }}</td>
              <td></td>
              <td>{{ task.resources.cpus }}</td>
              <td>{{ (task.resources.mem * 1024 * 1024) | autosize }}</td>
              <td>{{ task.framework_id }}/{{ task.executor_id }}</td>
              <td>{{ task.state }}</td>
            </tr>
          </tbody>

          <tbody>
            <tr>
              <th> </th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>

            <tr>
              <th>AVAILABLE</th>
              <th></th>
              <th>{{ (current_cluster.slaves | pluck:'resources.cpus' | sum) - ((current_cluster.frameworks | pluck:'tasks' | flatten) | pluck:'resources.cpus' | sum) }}</th>
              <th>{{ ((current_cluster.slaves | pluck:'resources.mem' | sum) - ((current_cluster.frameworks | pluck:'tasks' | flatten) | pluck:'resources.mem' | sum)) * 1024 * 1024 | autosize }}</th>
              <th></th>
              <th></th>
            </tr>
          </tbody>
        </table>
      </div>
    </tab>
  </tabset>
</div>