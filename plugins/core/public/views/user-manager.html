<div ng-controller="UserManagerController">
  <div class="container user-list" ng-show="users &amp;&amp; !noresults">
    <div class="row">
      <div class="span12">
        <h1>User Manager</h1>
        <br />
      </div>
    </div>

    <div class="row">
      <div class="span12">
        <div class="tabbable">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#users" data-toggle="tab">Users</a></li>
            <li><a href="#groups" data-toggle="tab">Groups</a></li>
            <li><a href="#capabilities" data-toggle="tab">Capabilities</a></li>
          </ul>
        </div>
      </div>
    </div>

    <br />

    <div class="tab-content">
      <div class="row tab-pane active" id="users">
        <div ng-class="_userClass">
            <div class="btn-group">
              <button class="btn"><i class="icon-plus"> </i> Add User</button>
            </div>

            <br />

            <table class="table table-condensed table-hover">
              <thead>
                <tr>
                  <th>&nbsp;</th>
                  <th ng-click="sortField='id'; sortReverse=!sortReverse">User ID</th>
                  <th ng-click="sortField='name'; sortReverse=!sortReverse">Name</th>
                  <th ng-click="sortField='type'; sortReverse=!sortReverse">Authentication Type</th>
                  <th ng-click="sortField='logged_in_at'; sortReverse=!sortReverse">Last Seen</th>
                </tr>
              </thead>

              <tbody>
                <tr ng-repeat="user in users | orderBy:sortField:sortReverse" ng-click="toggleUserPane(user)">
                  <td class="center"><input type="checkbox"></input></td>
                  <td class="id"><a>{{ user.id }}</a></td>
                  <td>{{ user.name }}</td>
                  <td>{{ user.type | replace:'User':'' | titleize }}</td>
                  <td>{{ user.logged_in_at &amp;&amp; (user.logged_in_at | timeAgo) || '-' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="span4" ng-show="userPaneUser">
            <div>
              <h3>{{ userPaneUser.id }}</h3>
              <br />
            </div>

            <form>
              <table class="table table-condensed">
                <tbody>
                  <tr>
                    <th>Full Name</th>
                    <td><input type="text" ng-model="userPaneUser.name" class="input-medium" /></td>
                  </tr>
                  <tr>
                    <td colspan="2">
                      <h5>
                        Groups ({{ userPaneUser.groups | length }})
                        <div class="dropdown pull-right">
                          <a class="dropdown-toggle" data-toggle="dropdown"><i class="icon-plus"> </i> </a>

                          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                            <li ng-repeat="group in groups"><a ng-click="addGroup(userPaneUser.id, group.id)">{{ group.id }}</a></li>
                          </ul>
                        </div>
                      </h5>

                      <ul class="nav">
                        <li ng-repeat="group in userPaneUser.groups">
                          <span>{{ group }}</span>
                          <span ng-click="removeGroup(userPaneUser.id, group.id)" class="pull-right"><i class="icon-remove"> </i></span>
                        </li>
                      </ul>
                    </td>
                  </tr>
                </tbody>
              </table>
            </form>
          </div>
        </div>

        <div class="row tab-pane" id="groups">
          <div ng-class="_groupClass">
            <div class="btn-group">
              <button class="btn"><i class="icon-plus"> </i> Add Group</button>
            </div>

            <br />

            <table class="table table-condensed table-hover">
              <thead>
                <tr>
                  <th>&nbsp;</th>
                  <th ng-click="sortField='id'; sortReverse=!sortReverse">Group ID</th>
                  <th ng-click="sortField='name'; sortReverse=!sortReverse">Name</th>
                  <th ng-click="sortField='users.length'; sortReverse=!sortReverse">Members</th>
                </tr>
              </thead>

              <tbody>
                <tr ng-repeat="group in groups | orderBy:sortField:sortReverse" ng-click="toggleGroupPane(group)">
                  <td class="center"><input type="checkbox"></input></td>
                  <td class="id"><a>{{ group.id }}</a></td>
                  <td>{{ group.name }}</td>
                  <td>{{ group.users | length }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="span4" ng-show="groupPaneGroup">
            <div>
              <h3>{{ groupPaneGroup.id }}</h3>
              <br />
            </div>

            <form>
              <table class="table table-condensed">
                <tbody>
                  <tr>
                    <th>Name</th>
                    <td><input type="text" ng-model="groupPaneGroup.name" class="input-medium" /></td>
                  </tr>
                  <tr>
                    <td colspan="2">
                      <h5>
                        Users ({{ groupPaneGroup.users | length }})
                        <span ng-click="addUser(groupPaneGroup)" class="pull-right"><i class="icon-plus"> </i></span>
                      </h5>

                      <ul class="nav">
                        <li ng-repeat="user in groupPaneGroup.users">
                          <span ng-show="user"><span ng-show="user.name">{{ user.name }} (</span>{{ user }}<span ng-show="user.name">)</span></span>
                          <span class="pull-right"><i class="icon-remove"> </i></span>
                        </li>
                      </ul>
                    </td>
                  </tr>
                </tbody>
              </table>
            </form>
          </div>
        </div>

        <div class="row tab-pane" id="capabilities">
          <div ng-class="_capabilityClass">
            <table class="table table-condensed table-hover">
              <thead>
                <tr>
                  <th>&nbsp;</th>
                  <th ng-click="sortField='id'; sortReverse=!sortReverse">Capability</th>
                  <th ng-click="sortField='name'; sortReverse=!sortReverse">Description</th>
                </tr>
              </thead>

              <tbody>
                <tr ng-repeat="capability in capabilities | orderBy:sortField:sortReverse">
                  <td class="center"><input type="checkbox"></input></td>
                  <td class="id"><a>{{ capability.id }}</a></td>
                  <td>{{ capability.description }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>