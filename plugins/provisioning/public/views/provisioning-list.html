<div ng-controller="ProvisioningController">
  <div ng-include="'views/device-spinner.html'" />

  <div class="container-fluid device-list provisioning" ng-show="results &amp;&amp; !noresults">
    <form>
      <div class="row-fluid">
        <div class="offset1 span10">
          <div class="alert alert-success" ng-show="saved">{{ saved == true &amp;&amp; 'Saved!' || saved }}</div>

          <br />

          <!-- normal mode actions -->
          <div ng-hide="editing">
            <button class="btn btn-success" ng-click="reload()"><i class="icon-refresh icon-white"></i> Reload</button>
            <button class="btn" ng-click="edit()"><i class="icon-pencil"></i> Edit</button>
          </div>

          <!-- edit mode actions -->
          <div ng-show="editing">
            <input type="submit" class="btn btn-primary" value="Save" ng-click="save()"></input>
            <input type="submit" class="btn btn-danger" value="Cancel" ng-click="editing=false"></input>
          </div>

          <br />
        </div>
      </div>

      <div class="row-fluid">
        <div class="offset1 span10">
          <table class="table table-condensed table-hover">
            <thead>
              <tr>
                <th>&nbsp;</th>
                <th ng-click="sortField='id'; sortReverse=!sortReverse">ID</th>
                <th ng-click="sortField='maintenance_status'; sortReverse=!sortReverse" class="center"><abbr title="Maintenance Status"><i class="icon-wrench"></i></abbr></th>
                <th ng-click="sortField='properties.model'; sortReverse=!sortReverse">Model</th>
                <th ng-click="sortField='name'; sortReverse=!sortReverse">Name</th>
                <th ng-click="sortField='properties.site'; sortReverse=!sortReverse">Site</th>
                <th ng-click="sortField='properties.rack'; sortReverse=!sortReverse">Rack</th>
                <th ng-click="sortField='properties.unit'; sortReverse=!sortReverse">Unit</th>
                <th ng-click="sortField='collected_at'; sortReverse=!sortReverse">Last Seen</th>
                <th ng-click="sortField='properties.notes'; sortReverse=!sortReverse" class="center">Notes</th>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="device in results | orderBy:sortField:sortReverse">
                <td class="select">
                  <input type="checkbox" />
                </td>

                <td class="id"><a tabindex="{{ results.length + $index + 1 }}" href="#/node/{{ device.id }}">{{ device.id }}</a></td>

                <td class="maintenance_status center">
                  <i class="icon-{{ (device.maintenance_status || 'healthy') }}" title="Needs {{ (device.maintenance_status || 'healthy') | titleize }}"></i>
                </td>

                <td>{{ device.properties.make }} {{ device.properties.model | section:' ':-1 }}</td>

                <td>
                  <span ng-hide="editing">{{ device.provisioning.hostname }}</span>
                  <input ng-show="editing" class="name" type="text" ng-model="device.provisioning.hostname">
                </td>

                <td>
                  <span ng-hide="editing">{{ device.properties.site }}</span>
                  <input ng-show="editing" class="site" type="text" ng-model="device.properties.site">
                </td>

                <td>
                  <span ng-hide="editing">{{ device.properties.rack }}</span>
                  <input ng-show="editing" class="rack" type="text" ng-model="device.properties.rack">
                </td>
                <td>
                  <span ng-hide="editing">{{ device.properties.unit }}</span>
                  <input ng-show="editing" class="unit" type="text" ng-model="device.properties.unit">
                </td>

                <td>{{ device.collected_at &amp;&amp; (device.collected_at | timeAgo) || '-' }}</td>

                <td>
                  <a
                    ui-jq="popover"
                    ui-options="note_tip_options(device.properties.notes)"
                    class="note_toggle center"
                    ng-show="device.properties.notes">
                    <i class="icon icon-comment"></i>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row-fluid">
        <div class="offset1 span10">
          <!-- edit mode actions -->
          <div ng-show="editing">
            <input type="submit" class="btn btn-primary" value="Save" ng-click="save()"></input>
            <input type="submit" class="btn btn-danger" value="Cancel" ng-click="editing=false"></input>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>